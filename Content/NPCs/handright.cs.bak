using Terraria;
using Terraria.ID;
using Terraria.ModLoader;
using Microsoft.Xna.Framework;

namespace broilinghell.Content.NPCs
{
    public class HandRight : ModNPC
    {
        // The ID of the NPC it should hover next to
        public int targetWhoAmI = -1;

        public override void SetStaticDefaults()
        {
            DisplayName.SetDefault("Hand of God");
        }

        public override void SetDefaults()
        {
            NPC.width = 40;
            NPC.height = 40;
            NPC.damage = 20;
            NPC.defense = 10;
            NPC.lifeMax = 10000000;
            NPC.HitSound = SoundID.NPCHit1;
            NPC.DeathSound = SoundID.NPCDeath1;
            NPC.value = 60f;
            NPC.knockBackResist = 0.5f;
            NPC.aiStyle = -1; // custom AI
            NPC.noGravity = true;
        }

        public override void AI()
        {
            // If we don’t have a target, find one
            if (targetWhoAmI == -1 || !Main.npc[targetWhoAmI].active)
            {
                // Look for the first active NPC of a specific type
                for (int i = 0; i < Main.maxNPCs; i++)
                {
                    if (Main.npc[i].active && Main.npc[i].type == ModContent.NPCType<bobultima>())
                    {
                        targetWhoAmI = i;
                        break;
                    }
                }
            }

            // If we found our main enemy, stick to its left
            if (targetWhoAmI != -1 && Main.npc[targetWhoAmI].active)
            {
                NPC target = Main.npc[targetWhoAmI];
                Vector2 desiredPosition = target.Center + new Vector2(80f, 0f); // 80 pixels to the left

                float speed = 10f;
                float inertia = 20f;

                Vector2 move = desiredPosition - NPC.Center;
                if (move.Length() > speed)
                {
                    move.Normalize();
                    move *= speed;
                }

                NPC.velocity = (NPC.velocity * (inertia - 1) + move) / inertia;
            }
        }
    }
}
